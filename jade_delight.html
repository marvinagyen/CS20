<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Jade Delight</title>

<script
src="https://code.jquery.com/jquery-3.6.0.js"
integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
crossorigin="anonymous">
</script>
</head>

<body>
<script language="javascript">

// DO NOT EDIT PRE-EXISTING CODE
// START

function MenuItem(name, cost)
{
	this.name = name;
	this.cost=cost;
}

menuItems = new Array(
	new MenuItem("Chicken Chop Suey", 4.5),
	new MenuItem("Sweet and Sour Pork", 6.25),
	new MenuItem("Shrimp Lo Mein", 5.25),
	new MenuItem("Moo Shi Chicken", 6.5),
	new MenuItem("Fried Rice", 2.35)
);

function makeSelect(name, minRange, maxRange)
{
	var t= "";
	t = "<select name='" + name + "' size='1'>";
	for (j=minRange; j<=maxRange; j++)
	   t += "<option>" + j + "</option>";
	t+= "</select>";
	return t;
}

// END
// DO NOT EDIT PRE-EXISTING CODE
</script>

<h1>Jade Delight</h1>
<form>

<p>First Name: <input type="text"  name='fname' /></p>
<p>Last Name*:  <input type="text"  name='lname' /></p>
<p>Street: <input type="text"  name='street' class = "address"/></p>
<p>City: <input type="text"  name='city' class = "address"/></p>
<p>Phone*: <input type="text"  name='phone' /></p>
<p>
	<input type="radio"  name="p_or_d" class = "time" id = "pickup" value = "pickup" checked="checked"/>Pickup
	<input type="radio"  name='p_or_d' class = "time" id = "delivery" value = 'delivery'/>
	Delivery
</p>
<table id ="table" border="0" cellpadding="3">
  <tr>
    <th>Select Item</th>
    <th>Item Name</th>
    <th>Cost Each</th>
    <th>Total Cost</th>
  </tr>
<script language="javascript">

  var s = "";
  for (i=0; i< menuItems.length; i++)
  {
	  s += "<tr><td>";
	  s += makeSelect("quan" + i, 0, 10);
	  s += "</td><td>" + menuItems[i].name + "</td>";
	  s += "<td> $ " + menuItems[i].cost.toFixed(2) + "</td>";
	  s += "<td>$<input type='text' name='cost'/></td></tr>";
  }
  document.writeln(s);

// MY CODE
// START


// Task 1: When quantity of item selected, it should be calculated and filled
// in immediately.
// Create function to sort through properties. Should be able to find the correct
// table, then row, then access its values. Use menuItems. then do computation
// to calculate cost, tax, and the final cost.

$("select").change(function(){
  let cost = 0;
	for(i = 0; i < menuItems.length; i++){
		let quani = "quan" + i;
		let itemPrice = $("select[name=" + quani + "] option:selected").val();
		itemPrice = itemPrice * menuItems[i].cost;
		itemPrice = itemPrice.toFixed(2);

		document.getElementsByTagName("tr")[i+1].getElementsByTagName("td")[3].innerHTML = "<td>$<input type = 'text' name='cost' value= " + (itemPrice) + " /></td></tr>";

		// oldCost does not pick up on decreasing the quantity because line 105 says
		// that oldCost is not null so we should still add the price

		// Solution: recalc oldCost?

    cost += parseFloat(itemPrice);

	}
  cost = cost.toFixed(2);
  $("[name = 'subtotal']").val(cost);
  let tax = cost * .0625;
  tax = tax.toFixed(2);
  $("[name = 'tax']").val(tax);
  let finalCost = parseFloat(cost) + parseFloat(tax);
  finalCost = finalCost.toFixed(2);
  $("[name = 'total']").val(finalCost);
})

// Task 2: Hide code onload. When I click Delivery, Street and City will be shown.
// When I click Pickup, Street and city will be hidden.
// COMPLETE

$("#delivery").click(function () {
	 $(".address").show(100);
});

$("#pickup").click(function () {
	 $(".address").hide(100);
});

$(document).ready(function(){
	$(".address").hide(100)
});

// Task 3: Multiple Parts!
// Verify that the phone number and last name are entered. Phone number must
// be a valid number. Will likely have to use a function to validate the 2 by
// determining if the form is empty. Search up function to check phone numbers


function phonenum_validate(phonenum){
	var regExpNum = /^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im;

  return regExpNum.test(phonenum);
}

function generalform_validate(){
	let valid = true;

	if ($("[name='lname']").val() == ""){
		valid = false;
	}

	if(document.getElementsByClassName("address")[1].checked){
		if($("[name='street']").val() == ""){
			valid = false;
		}

		if($("[name='city']").val() == ""){
			valid = false;
		}
	}

	if ($("[name='phone']").val() == ""){
		valid = false;
	}

	let phonenum = $("[name='phone']").val();
	if (phonenum_validate(phonenum) == false){
		valid = false;
	}

	if($("[name='subtotal']").val() == ""){
		valid = false;
	}

return valid;
}

// Determining delivery time. Use built in time functions to determine time

function submission(){
	valid = generalform_validate();
	if(valid == false){
		alert("Error related to validation, please check form entries again.")
	} else {
		let eta = 0;
		let datetime = new Date();
		eta = datetime.getHours() % 12;
		if(document.getElementsByClassName("time")[1].checked){

			let mins = datetime.getMinutes() + 30;
			if(mins > 60){
				eta++;
				mins = mins % 60;
			}
			eta = eta + ":"
			if(mins < 10){
				eta = eta + "0"
			}
			eta = eta + mins;

		} else {
				mins = datetime.getMinutes() + 15;
				if(mins > 60){
					eta++;
					mins = mins % 60;
				}
				eta = eta + ":";

				if(mins < 10){
					eta = eta + "0";
				}
				eta = eta + mins;

		}

		// now print all of the
		finalCost = $("[name='total']").val();
		let finalOrder = "Your order: "
		for(i = 0; i < menuItems.length; i++){
			quani = "quan" + i;
			let quantity = $("select[name=" + quani + "] option:selected").val();

			if(quantity != 0){
				finalOrder = finalOrder + quantity + " " + menuItems[i].name + ",";
			}
		}

		let msg = "Thank you for your order! " + finalOrder +  ". Your order will be done by " + eta + " and the total cost of the order is $" + finalCost + ".";

		let confirmation = window.open("", "confirmation", "width=500,height=300");
		confirmation.document.write(msg);
	}
	}

// END
// MY CODE

</script>
</table>
<p>Subtotal:
   $<input type="text" name='subtotal' id="subtotal" />
</p>
<p>Mass tax 6.25%:
  $ <input type="text"  name='tax' id="tax" />
</p>
<p>Total: $ <input type="text"  name='total' id="total" />
</p>

<input type = "button" value = "Submit Order" onclick="submission()" />

</form>
</body>
</html>
